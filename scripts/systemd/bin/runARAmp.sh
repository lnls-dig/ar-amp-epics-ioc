#!/usr/bin/env bash
	
set -u

if [ -z "$ARAMP_INSTANCE" ]; then
    echo "ARAMP_INSTANCE environment variable is not set." >&2
    exit 1
fi

export ARAMP_CURRENT_PV_AREA_PREFIX=ARAMP_${ARAMP_INSTANCE}_PV_AREA_PREFIX
export ARAMP_CURRENT_PV_DEVICE_PREFIX=ARAMP_${ARAMP_INSTANCE}_PV_DEVICE_PREFIX
export ARAMP_CURRENT_DEVICE_IP=ARAMP_${ARAMP_INSTANCE}_DEVICE_IP
export ARAMP_CURRENT_DEVICE_PORT=ARAMP_${ARAMP_INSTANCE}_DEVICE_PORT
export ARAMP_CURRENT_DEVICE_TELNET_PORT=ARAMP_${ARAMP_INSTANCE}_TELNET_PORT
# Only works with bash
export ARAMP_PV_AREA_PREFIX=${!ARAMP_CURRENT_PV_AREA_PREFIX}
export ARAMP_PV_DEVICE_PREFIX=${!ARAMP_CURRENT_PV_DEVICE_PREFIX}
export ARAMP_DEVICE_IP=${!ARAMP_CURRENT_DEVICE_IP}
export ARAMP_DEVICE_PORT=${!ARAMP_CURRENT_DEVICE_PORT}
export ARAMP_DEVICE_TELNET_PORT=${!ARAMP_CURRENT_DEVICE_TELNET_PORT}

if [ -z "${ARAMP_DEVICE_TELNET_PORT}" ]; then
    echo "TELNET port is not set." >&2
    exit 1
fi

./runProcServ.sh \
    -t "${ARAMP_DEVICE_TELNET_PORT}" \
    -i "${ARAMP_DEVICE_IP}" \
    -p "${ARAMP_DEVICE_PORT}" \
    -P "${ARAMP_PV_AREA_PREFIX}" \
    -R "${ARAMP_PV_DEVICE_PREFIX}"

